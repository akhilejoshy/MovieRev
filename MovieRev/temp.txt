
class LatestMovies(View):
    def get(self, request):
        query = request.GET.get("q")
        today, last_month = date.today(), date.today() - timedelta(days=30)
        movies_by_language = {}

        for lang, code in LANGUAGES.items():
    
            url = (
                f"{BASE_URL}/discover/movie?api_key={API_KEY}"
                f"&with_original_language={code}"
                f"&primary_release_date.gte={last_month.strftime('%Y-%m-%d')}"
                f"&primary_release_date.lte={today.strftime('%Y-%m-%d')}"
                f"&sort_by=popularity.desc"
                f"&page=1"
            )
            
            movies_by_language[lang] = self.fetch_movies(url)

        return render(request, "movies/latest.html", {"trending_latest_movies_by_language": movies_by_language, "query": query})

    def fetch_movies(self, url):
        try:
            response = requests.get(url, timeout=5)
            response.raise_for_status()
            return response.json().get("results", [])[:6]
        except requests.exceptions.RequestException as e:
            print(f"Error fetching movies: {e}")  
            return []




from django.db import models

class Movie(models.Model):
    release_date = models.DateField(blank=True, null=True)
    genre = models.CharField(max_length=255, blank=True, null=True)
    overview = models.TextField(blank=True, null=True)  # Short description

    def __str__(self):
        return self.title


class Review(models.Model):
    tmdb_id = models.IntegerField()  # Store the TMDB movie ID
    title = models.CharField(max_length=255)
    poster_path = models.CharField(max_length=500, blank=True, null=True)  # Poster image URL

    comment = models.TextField()  # User review text
    rating = models.PositiveIntegerField(default=0)  # Rating (1-5 or 1-10 scale)
    created_at = models.DateTimeField(auto_now_add=True)  # Timestamp when review was created

    user = models.ForeignKey(User, on_delete=models.CASCADE)  # Each review belongs to one user

    

    def __str__(self):
        return f"{self.user.username} - {self.movie.title} ({self.rating}/5)"

class Wishlist(models.Model):
    tmdb_id = models.IntegerField()  # Store the TMDB movie ID
    title = models.CharField(max_length=255)
    poster_path = models.CharField(max_length=500, blank=True, null=True)  # Poster image URL

    user = models.ForeignKey(User, on_delete=models.CASCADE)

    class Meta:
        unique_together = ('user', 'movie')  # Prevent duplicate wishlist entries

    def __str__(self):
        return f"{self.user.username} - {self.movie.title}"





<!-- Bootstrap Nav Tabs -->
<ul class="nav nav-pills mb-3 justify-content-center" id="pills-tab" role="tablist">
    <!-- Reviewed Tab -->
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="pills-reviewed-tab" data-bs-toggle="pill" data-bs-target="#pills-reviewed" 
            type="button" role="tab" aria-controls="pills-reviewed" aria-selected="true">
            Reviewed
        </button>
    </li>

    <!-- Liked Tab -->
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="pills-liked-tab" data-bs-toggle="pill" data-bs-target="#pills-liked" 
            type="button" role="tab" aria-controls="pills-liked" aria-selected="false">
            Liked
        </button>
    </li>
</ul>

<!-- Tab Content -->
<div class="tab-content" id="pills-tabContent">
    <!-- Reviewed Section -->
    <div class="tab-pane fade show active" id="pills-reviewed" role="tabpanel" aria-labelledby="pills-reviewed-tab">
        <div class="bg-dark text-white p-4 rounded">
            <h2 class="text-center">Your Watchlist</h2>
            <p class="text-center">Total reviewed Movies: {{ r_count }}</p>

            {% if reviews %}
            <div class="row d-flex justify-content-around">
                {% for review in reviews %}
                <div class="card bg-transparent text-white mb-3 border-0 rounded-start-4" style="max-width: 550px;">
                    <div class="row">
                        <div class="col-md-4 p-0">
                            <img src="https://image.tmdb.org/t/p/w500{{ review.poster_path }}"
                                class="img-fluid rounded-start-3" alt="{{ review.title }}">
                        </div>
                        <div class="col-md-8 card-body">
                            <div class="h-100 d-flex flex-column">
                                <h4 class="card-title mb-0">{{ review.title }}</h4>
                                <small class="text-white-50 fw-lighter">Last updated
                                    {{review.created_at|date:"F d,Y"}}</small>
                                <p class="card-text h-25 mt-3">{{ review.comment }}</p>
                                <div class="d-flex align-items-center gap-3 text-primary">
                                    {% for _ in review.solid %}
                                    <i class="fa-solid fa-star text-warning"></i>
                                    {% endfor %}

                                    {% for _ in review.regular %}
                                    <i class="fa-regular fa-star text-warning"></i>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-center text-warning">No movies in your Watchlist yet.</p>
            {% endif %}
        </div>
    </div>

    <!-- Liked Section -->
    <div class="tab-pane fade" id="pills-liked" role="tabpanel" aria-labelledby="pills-liked-tab">
        <div class="bg-dark text-white p-4 rounded">
            <h2 class="text-center">Your Watchlist</h2>
            <p class="text-center">Total Saved Movies: {{ s_count }}</p>

            {% if saved_movies %}
            <div class="row">
                {% for movie in saved_movies %}
                <div class="col-md-2 mb-4">
                    <div class="card bg-dark text-white border-0">
                        <a href="{% url 'movie_detail' movie_id=movie.movie_id %}" class="text-decoration-none">
                            <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}"
                                class="card-img-top rounded-4" alt="{{ movie.title }}">
                            <div class="card-body text-center">
                                <h5 class="card-title text-white">{{ movie.title }}</h5>
                            </div>
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-center text-warning">No movies in your Watchlist yet.</p>
            {% endif %}
        </div>
    </div>
</div>


    <!-- <a href="{% url 'movie_detail' movie_id=review.movie_id %}" class="text-decoration-none   "> -->
